<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="js/jquery-3.1.1.js"></script>
    <link rel="stylesheet" href="css/mine.css">
    <link rel="stylesheet" href="css/scoll.css">
    <link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css">
    <title>insuite进度管理</title>
    <style>
        /*解决子DIV溢出问题*/
        #finish:after,#finish_title:after,#finish_cont:after,#working:after{
            content: ".";
            display: block;
            height: 0;
            clear: both;
            visibility: hidden;
        }
        /*顶栏*/
        /*目录*/
        /*新建项目*/
    </style>
    <script src="js/bmob.js"></script>


    <script type="text/javascript">

        function load(){
            Bmob.initialize('910877821e33c3b0d45d9062c88b328b', "7f0c48b1bb7d8e07096312ce260163d1");
            var findcolumn = Bmob.Object.extend("project");
            var query = new Bmob.Query(findcolumn);
// 查询所有数据
            query.find({
                success: function(results) {
                    console.log("共查询到 " + results.length + " 条记录");
                    // 循环处理查询到的数据
                    for (var i = 0; i < results.length; i++) {
                        var url="location.href='project_info.html?pid="+results[i].id+"'";
						if(results[i].get('deleted')!=true){
                        if(results[i].get('active')==true){
                            var s2=new Date();
                            var days1 = new Date(results[i].get('etime'));
                            var days2 = new Date(results[i].get('ltime'));
                            var edays = parseInt((days1.getTime() - s2.getTime())/(3600000*24));
                            var ldays = parseInt((days2.getTime() - s2.getTime())/(3600000*24));
                            var object =  '<div class="project_list" onclick = "'+url+'" ><div class="cover"><div class="cover_name">'+results[i].get('name')+'</div> <div class="cover_deadline">締め切り日まで<span>'+ edays+'日|'+ ldays+'日</span>がある</div> </div><img src="'+results[i].get('pic')['_url']+'" alt=""></div>';
                            jQuery(object).appendTo(jQuery("#working"));
                            process=results[i].get('process')
                        }
                        else
                        {
                            var days1 = new Date(results[i].createdAt);
                            days1=days1.getFullYear()+'.'+(days1.getMonth()+1)+'.'+days1.getDate();
                            var days2 = new Date(results[i].get('finishtime'));
                            days2=days2.getFullYear()+'.'+(days2.getMonth()+1)+'.'+days2.getDate();
                            var object =  '<div class="project_list"><div class="cover"><div class="cover_name">'+results[i].get('name')+'</div> <div class="cover_deadline">'+days1+'-'+days2+'</div> </div><img src="'+results[i].get('pic')['_url']+'" alt=""></div>';
                            jQuery(object).appendTo(jQuery("#finish_cont"));
                        }}
                    }
                },
                error: function(error) {
                    alert("查询失败: " + error.code + " " + error.message);
                }
            });}


    </script>
    <title>insuite進度管理</title>


</head>

<body onload= load() >
<div id="cover"></div>
<nav id="top">
    <img src="img/LOGO.png" alt="" id="logo" title="返回首页">
    <div id="tab">
        <div id="tab_project " class="tab tab_active">
            一覧
        </div>
        <div id="tab_my" class="tab">
            自分
        </div>
    </div>
    <div id="user">
        <i class="fa fa-2x fa-user-circle-o" aria-hidden="true" title="个人中心"></i>
    </div>
</nav>
<nav id="top2"></nav>
<div id="index"><!--最初的目录-->
    <div id="working"><!--正在进行的项目-->
        <div class="index_title">開発中のプロジェクト</div>
        <div id="new_project" class="project_list"><!--新建-->
            <div id="icon_plus_bg">
                <img id="icon_plus" src="img/plus.png">
            </div>

        </div>
    </div>
    <div style="border-bottom: 1px solid #c2c2c2;width: 1000px;margin-left: 200px"></div>
    <div id="finish"><!--项目归档-->
        <div id="finish_title">
            <div class="index_title" >終わりのプロジェクト</div>
            <div class="triangle_down" style="margin:13px 0 0 8px" onclick="$('.triangle_down').hide();
                $('.triangle_up').show();
                $('#finish_cont').fadeIn(); " ></div>
            <div class="triangle_up" style="margin:13px 0 0 8px;display: none " onclick='  $(".triangle_up").css("display","none");
                $(".triangle_down").css("display","block");
                $("#finish_cont").fadeOut();'></div>
        </div>
        <div id="finish_cont" style="display: none;">
            <!--<div class="project_list" id="project2">&lt;!&ndash;已建立的项目&ndash;&gt;-->

            <!--</div>-->
        </div>
    </div>
</div>

</body>
</html>
<script type="text/javascript">
    $("#new_project").click(function () {
        window.location.href="create_project.html"
    });
    $("#tab div").click(function(){
        $(".tab_active").removeClass("tab_active");
        $(this).addClass("tab_active");
    });
//    $("#logo").click(function () {
//        $("#index").fadeIn();
//        $("#create").css("display","none");
//    });
</script>
